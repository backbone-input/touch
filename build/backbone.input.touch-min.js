!function(t){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],t):t($,_,Backbone)}(function(t,o,n){var i=i||{},e=function(t,n){return t&&t[n]?o.isFunction(t[n])?t[n]():t[n]:null},h=/^(\S+)\s*(.*)$/,c=n.View,s=c.prototype.params||new n.Model;s.set({touches:{}});var u=c.extend({name:"touch",options:o.extend({},c.prototype.options,{touch:{fastclick:"undefined"==typeof i.FastClick?!0:!1}}),events:o.extend({},c.prototype.events,{touchstart:"_touchstart",touchmove:"_touchmove",touchend:"_touchend"}),params:s,initialize:function(){return this.options.touch=this.options.touch||{},this.options.touch.fastclick&&this.fastClick(this.events),c.prototype.initialize.apply(this,arguments)},_touchstart:function(t){var n=o.inArray("touch",this.options.monitor);n&&(o.inDebug()&&console.log("touchstart",t),this.trigger("touchstart",t),this.touchstart&&this.touchstart(t))},_touchmove:function(t){var n=o.inArray("touch",this.options.monitor);n&&(t.preventDefault&&t.preventDefault(),o.inDebug()&&console.log("touchmove",t),this.trigger("touchmove",t),this.touchmove&&this.touchmove(t))},_touchend:function(t){var n=o.inArray("touch",this.options.monitor);n&&(o.inDebug()&&console.log("touchend",t),this.trigger("touchend",t),this.touchend&&this.touchend(t))},_touch_findEl:function(o,n){var i={top:0,left:0},e=null;return t(this.el).find(o).each(function(){var o=t(this).offset();return n.top-o.top>=0&&o.top>=i.top?(i=o,e=this):void 0}),e},_touching:!1,touchPrevents:!0,touchThreshold:10,isTouch:"ontouchstart"in document&&!("callPhantom"in i),fastClick:function(t){if(this.isTouch&&(t||(t=e(this,"events")))){{var n=this;".delegateEvents"+this.cid}o(t).each(function(i,e){if(o.isFunction(i)||(i=this[t[e]]),!i)throw new Error('Method "'+t[e]+'" does not exist');var c=e.match(h),s=c[1],u=c[2],r=o.bind(n._touchHandler,n);i=o.bind(i,n),"click"===s&&(this.$el.off("click",u),this.$el.on("touchstart",u,r),this.$el.on("touchend",u,{method:i},r))},this)}},_touchHandler:function(t){if("changedTouches"in t.originalEvent){var o=t.originalEvent.changedTouches[0],n=o.clientX,i=o.clientY;switch(t.type){case"touchstart":this._touching=[n,i];break;case"touchend":var e=this._touching[0],h=this._touching[1],c=this.touchThreshold;if(e+c>n&&n>e-c&&h+c>i&&i>h-c){if(this._touching=!1,this.touchPrevents){var s=t.currentTarget.tagName;("BUTTON"===s||"A"===s)&&(t.preventDefault(),t.stopPropagation())}t.data.method(t)}}}}});return o.mixin({inArray:function(t,o){return o.indexOf(t)>-1},inDebug:function(){return"undefined"!=typeof DEBUG&&DEBUG}}),n.View=u,n});