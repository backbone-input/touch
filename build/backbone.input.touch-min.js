!function(t){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],t):t($,_,Backbone)}(function(t,i,o){var e=e||{},n=function(t,o){return t&&t[o]?i.isFunction(t[o])?t[o]():t[o]:null},s=/^(\S+)\s*(.*)$/,c=o.View,h={fastclick:"undefined"==typeof e.FastClick?!0:!1,threshold:10,inertia:0,blocking:!0,auto:!0},r=c.prototype.params||new o.Model;r.set({touchPrevious:{},touchStart:{},touches:{}});var u=c.prototype.state||new o.Model;u.set({touching:!1,clicking:!1,swiping:!1,direction:!1});var a=c.extend({name:"touch",events:i.extend({},c.prototype.events,{touchstart:"_touchstart",touchmove:"_touchmove",touchend:"_touchend"}),params:r,state:u,initialize:function(t){return t=t||{},t.touch=t.touch||{},this.options.touch=i.extend({},h,t.touch),this.options.monitor=this.options.monitor||[],this.options.touch.fastclick&&this.fastClick(this.events),this.options.touch.auto&&this.isTouch&&!i.inArray("touch",this.options.monitor)&&this.options.monitor.push("touch"),c.prototype.initialize.apply(this,arguments)},isTouch:"ontouchstart"in document&&!("callPhantom"in e),_touchstart:function(t){var o=i.inArray("touch",this.options.monitor);if(o){i.inDebug()&&console.log("touchstart",t);var e=t.originalEvent.touches;this.params.set({touchStart:i.extend({},e)}),this.params.set({touches:i.extend({},e)}),this.trigger("touchstart",t),this.touchstart&&this.touchstart(t)}},_touchmove:function(t){var o=i.inArray("touch",this.options.monitor);if(o){i.inDebug()&&console.log("touchmove",t);var e=t.originalEvent.touches;if(1===e.length){var n=this.params.get("touchPrevious"),s=i.isEmpty(n)?!1:this._touchDirection(e[0],n[0]);this.state.set({swiping:s?!0:!1,direction:s}),this.params.set({touchPrevious:i.extend({},e)}),("left"==s||"right"==s)&&t.preventDefault&&t.preventDefault()}this.params.set({touches:e}),this.trigger("touchmove",t),this.touchmove&&this.touchmove(t)}},_touchend:function(t){var o=i.inArray("touch",this.options.monitor);if(o){i.inDebug()&&console.log("touchend",t);var e=t.originalEvent.touches;this.params.set({touches:i.extend({},e)}),e.length||(this.state.set({touching:!1,clicking:!1,swiping:!1}),this.params.unset("touchPrevious"),this.params.unset("touchStart"),this.params.unset("touches")),this.trigger("touchend",t),this.touchend&&this.touchend(t)}},_touch_findEl:function(i,o){var e={top:0,left:0},n=null;return t(this.el).find(i).each(function(){var i=t(this).offset();return o.top-i.top>=0&&i.top>=e.top?(e=i,n=this):void 0}),n},fastClick:function(t){if(this.isTouch&&(t||(t=n(this,"events")))){{var o=this;".delegateEvents"+this.cid}i(t).each(function(e,n){if(i.isFunction(e)||(e=this[t[n]]),!e)throw new Error('Method "'+t[n]+'" does not exist');var c=n.match(s),h=c[1],r=c[2],u=i.bind(o._touchHandler,o);e=i.bind(e,o),"click"===h&&(this.$el.off("click",r),this.$el.on("touchstart",r,u),this.$el.on("touchend",r,{method:e},u))},this)}},_touchHandler:function(t){if("changedTouches"in t.originalEvent){var o=t.originalEvent.changedTouches,e=o[0].clientX,n=o[0].clientY;switch(t.type){case"touchstart":this.state.set({clicking:!0}),this.params.set({touches:i.extend({},o)});break;case"touchmove":this.state.set({clicking:!1});break;case"touchend":var s=this.params.get("touches")[0],c=this.options.touch.threshold;if(e<s.clientX+c&&e>s.clientX-c&&n<s.clientY+c&&n>s.clientY-c){if(this.state.set({clicking:!1}),this.options.touch.blocking){var h=t.currentTarget.tagName;("BUTTON"===h||"A"===h)&&(t.preventDefault(),t.stopPropagation())}t.data.method(t)}}}},_touchDirection:function(t,i){var o=!1,e=this.options.touch.inertia,n=this.options.touch.threshold,s=t.clientX-i.clientX,c=t.clientY-i.clientY;return s>e&&n>c?o="right":-e>s&&n>c?o="left":c>e&&n>s?o="bottom":-e>c&&n>s&&(o="top"),o},_touchDistance:function(t,i){t=t||0,i=i||"x";var o=this.params.get("touchStart"),e=this.params.get("touches"),n={x:"clientX",y:"clientY"};return e[t][n[i]]-o[t][n[i]]}});return i.mixin({inArray:function(t,i){return i.indexOf(t)>-1},inDebug:function(){return"undefined"!=typeof DEBUG&&DEBUG},copy:function(t){return JSON.parse(JSON.stringify(t))},extend:function(){var t=Array.prototype.slice.call(arguments),i=t.shift();for(var o in t){var e=t[o];for(var n in e)e[n]&&e[n].constructor&&e[n].constructor===Object?(i[n]=i[n]||{},arguments.callee(i[n],e[n])):i[n]=e[n]}return i}}),o.View=a,o});