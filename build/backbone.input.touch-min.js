!function(t){"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],t):t($,_,Backbone)}(function(t,e,o){var i=i||{},n=function(t,o){return t&&t[o]?e.isFunction(t[o])?t[o]():t[o]:null},s=/^(\S+)\s*(.*)$/,c=o.View,h=c.prototype.params||new o.Model;h.set({touches:{}});var r=c.prototype.state||new o.Model;r.set({touching:!1,clicking:!1,direction:!1});var u=c.extend({name:"touch",options:e.extend({},c.prototype.options,{touch:{fastclick:"undefined"==typeof i.FastClick?!0:!1}}),events:e.extend({},c.prototype.events,{touchstart:"_touchstart",touchmove:"_touchmove",touchend:"_touchend"}),params:h,state:r,initialize:function(){return this.options.touch=this.options.touch||{},this.options.touch.fastclick&&this.fastClick(this.events),c.prototype.initialize.apply(this,arguments)},isTouch:"ontouchstart"in document&&!("callPhantom"in i),_touchstart:function(t){var o=e.inArray("touch",this.options.monitor);if(o){e.inDebug()&&console.log("touchstart",t);var i=t.originalEvent.touches;this.params.set({touches:i}),this.trigger("touchstart",t),this.touchstart&&this.touchstart(t)}},_touchmove:function(t){var o=e.inArray("touch",this.options.monitor);if(o){t.preventDefault&&t.preventDefault(),e.inDebug()&&console.log("touchmove",t);var i=t.originalEvent.touches;this.params.set({touches:i}),this.trigger("touchmove",t),this.touchmove&&this.touchmove(t)}},_touchend:function(t){var o=e.inArray("touch",this.options.monitor);if(o){e.inDebug()&&console.log("touchend",t);var i=t.originalEvent.touches;this.params.set({touches:i}),this.trigger("touchend",t),this.touchend&&this.touchend(t)}},_touch_findEl:function(e,o){var i={top:0,left:0},n=null;return t(this.el).find(e).each(function(){var e=t(this).offset();return o.top-e.top>=0&&e.top>=i.top?(i=e,n=this):void 0}),n},touchPrevents:!0,touchThreshold:10,fastClick:function(t){if(this.isTouch&&(t||(t=n(this,"events")))){{var o=this;".delegateEvents"+this.cid}e(t).each(function(i,n){if(e.isFunction(i)||(i=this[t[n]]),!i)throw new Error('Method "'+t[n]+'" does not exist');var c=n.match(s),h=c[1],r=c[2],u=e.bind(o._touchHandler,o);i=e.bind(i,o),"click"===h&&(this.$el.off("click",r),this.$el.on("touchstart",r,u),this.$el.on("touchend",r,{method:i},u))},this)}},_touchHandler:function(t){if("changedTouches"in t.originalEvent){var e=t.originalEvent.changedTouches,o=e[0].clientX,i=e[0].clientY;switch(t.type){case"touchstart":this.state.set({clicking:!0}),this.params.set({touches:e});break;case"touchmove":this.state.set({clicking:!1});break;case"touchend":var n=this.params.get("touches")[0],s=this.touchThreshold;if(o<n.clientX+s&&o>n.clientX-s&&i<n.clientY+s&&i>n.clientY-s){if(this.state.set({clicking:!1}),this.touchPrevents){var c=t.currentTarget.tagName;("BUTTON"===c||"A"===c)&&(t.preventDefault(),t.stopPropagation())}t.data.method(t)}}}}});return e.mixin({inArray:function(t,e){return e.indexOf(t)>-1},inDebug:function(){return"undefined"!=typeof DEBUG&&DEBUG}}),o.View=u,o});