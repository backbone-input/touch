!function(t){if("function"==typeof define&&define.amd)define("backbone.input.touch",["jquery","underscore","backbone"],t);else if("object"==typeof module&&module&&"object"==typeof module.exports)module.exports=t;else{var o=window.jQuery||window.Zepto||window.vQuery;t(o,window._,window.Backbone)}}(function(t,o,e){var i=i||window.APP||null,n=null!==i,s=n&&"undefined"!=typeof i.View?i.View:e.View,c=function(t,e){return t&&t[e]?o.isFunction(t[e])?t[e]():t[e]:null},h=/^(\S+)\s*(.*)$/,r={fastclick:"undefined"==typeof window.FastClick?!0:!1,threshold:10,inertia:0,blocking:!0,auto:!0},u=s.prototype.params||new e.Model;u.set({touchPrevious:{},touchStart:{},touches:{}});var a=s.prototype.state||new e.Model;a.set({touching:!1,clicking:!1,swiping:!1,direction:!1});var l=s.extend({name:"touch",events:o.extend({},s.prototype.events,{touchstart:"_touchstart",touchmove:"_touchmove",touchend:"_touchend"}),params:u.clone(),state:a.clone(),initialize:function(t){return t=t||{},t.touch=t.touch||{},this.options.touch=o.extend({},r,t.touch),this.options.monitor=this.options.monitor||[],this.options.touch.fastclick&&this.fastClick(this.events),this.options.touch.auto&&this.isTouch&&!o.inArray("touch",this.options.monitor)&&this.options.monitor.push("touch"),s.prototype.initialize.apply(this,arguments)},isTouch:"ontouchstart"in document&&!("callPhantom"in window),_touchstart:function(t){var e=o.inArray("touch",this.options.monitor);if(e){o.inDebug()&&console.log("touchstart",t);var i=t.originalEvent.touches;this.params.set({touchStart:o.extend({},i)}),this.params.set({touches:o.extend({},i)}),this.trigger("touchstart",t),this.touchstart&&this.touchstart(t)}},_touchmove:function(t){var e=o.inArray("touch",this.options.monitor);if(e){o.inDebug()&&console.log("touchmove",t);var i=t.originalEvent.touches;if(1===i.length){var n=this.params.get("touchPrevious"),s=o.isEmpty(n)?!1:this._touchDirection(i[0],n[0]);this.state.set({swiping:s?!0:!1,direction:s}),this.params.set({touchPrevious:o.extend({},i)}),("left"==s||"right"==s)&&t.preventDefault&&t.preventDefault()}this.params.set({touches:i}),this.trigger("touchmove",t),this.touchmove&&this.touchmove(t)}},_touchend:function(t){var e=o.inArray("touch",this.options.monitor);if(e){o.inDebug()&&console.log("touchend",t);var i=t.originalEvent.touches;this.params.set({touches:o.extend({},i)}),i.length||(this.state.set({touching:!1,clicking:!1,swiping:!1}),this.params.unset("touchPrevious"),this.params.unset("touchStart"),this.params.unset("touches")),this.trigger("touchend",t),this.touchend&&this.touchend(t)}},_touch_findEl:function(o,e){var i={top:0,left:0},n=null;return t(this.el).find(o).each(function(){var o=t(this).offset();return e.top-o.top>=0&&o.top>=i.top?(i=o,n=this):void 0}),n},fastClick:function(t){if(this.isTouch&&(t||(t=c(this,"events")))){{var e=this;".delegateEvents"+this.cid}o(t).each(function(i,n){if(o.isFunction(i)||(i=this[t[n]]),!i)throw new Error('Method "'+t[n]+'" does not exist');var s=n.match(h),c=s[1],r=s[2],u=o.bind(e._touchHandler,e);i=o.bind(i,e),"click"===c&&(this.$el.off("click",r),this.$el.on("touchstart",r,u),this.$el.on("touchend",r,{method:i},u))},this)}},_touchHandler:function(t){if("changedTouches"in t.originalEvent){var e=t.originalEvent.changedTouches,i=e[0].clientX,n=e[0].clientY;switch(t.type){case"touchstart":this.state.set({clicking:!0}),this.params.set({touches:o.extend({},e)});break;case"touchmove":this.state.set({clicking:!1});break;case"touchend":var s=this.params.get("touches")[0],c=this.options.touch.threshold;if(i<s.clientX+c&&i>s.clientX-c&&n<s.clientY+c&&n>s.clientY-c){if(this.state.set({clicking:!1}),this.options.touch.blocking){var h=t.currentTarget.tagName;("BUTTON"===h||"A"===h)&&(t.preventDefault(),t.stopPropagation())}t.data.method(t)}}}},_touchDirection:function(t,o){var e=!1,i=this.options.touch.inertia,n=this.options.touch.threshold,s=t.clientX-o.clientX,c=t.clientY-o.clientY;return s>i&&n>c?e="right":-i>s&&n>c?e="left":c>i&&n>s?e="bottom":-i>c&&n>s&&(e="top"),e},_touchDistance:function(t,o){t=t||0,o=o||"x";var e=this.params.get("touchStart"),i=this.params.get("touches"),n={x:"clientX",y:"clientY"};return i[t][n[o]]-e[t][n[o]]}});return o.mixin({inArray:function(t,o){return o.indexOf(t)>-1},inDebug:function(){return"undefined"!=typeof DEBUG&&DEBUG},copy:function(t){return JSON.parse(JSON.stringify(t))},extend:function(){var t=Array.prototype.slice.call(arguments),o=t.shift();for(var e in t){var i=t[e];for(var n in i)i[n]&&i[n].constructor&&i[n].constructor===Object?(o[n]=o[n]||{},arguments.callee(o[n],i[n])):o[n]=i[n]}return o}}),e.Input=e.Input||{},e.Input.Touch=l,n&&(i.Input=i.Input||{},i.Input.Touch=l),"object"==typeof window&&"object"==typeof window.document&&(window.Backbone=e,n&&(window.APP=i)),l});